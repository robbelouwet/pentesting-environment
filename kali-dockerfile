FROM kalilinux/kali-rolling

# systemctl replacement:
ADD https://raw.githubusercontent.com/gdraheim/docker-systemctl-replacement/master/files/docker/systemctl.py /usr/local/bin/systemctl

COPY ./copy-files/*.ovpn /config.ovpn
COPY ./copy-files/id_rsa_host.pub /root/.ssh/id_rsa_host.pub

RUN \
    mkdir /run/sshd &&\
    mkdir -p /var/lib/postgresql &&\
    apt-get update -y && apt-get install -y apt-utils ca-certificates ssh &&\
    echo "PubKeyAuthentication yes" >> /etc/ssh/sshd_config &&\
    cat /root/.ssh/id_rsa_host.pub >> /root/.ssh/authorized_keys &&\
    sed -i 's/http/https/' /etc/apt/sources.list &&\
    apt-get update -y && apt-get dist-upgrade -y && apt-get autoremove -y && apt-get clean -y &&\
    chmod +x /usr/local/bin/systemctl &&\
    mv /usr/bin/systemctl /usr/bin/systemctl.old &&\
    ln -s /usr/local/bin/systemctl /usr/bin/systemctl &&\
    echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config &&\
    echo -e '#!/bin/bash\nopenvpn --config /config.ovpn --daemon' > /connect.sh &&\
    chmod +x /connect.sh &&\
    DEBIAN_FRONTEND=noninteractive apt-get install -y tshark &&\
    apt install -y python2 lsof iputils-ping net-tools man-db exploitdb openvpn nano coreutils procps vim wget curl httpie kali-tools-top10
