# Description
A docker-compose.yml file building a pentesting environment based on kalilinux/kali-rolling using kali-tools-top10. Second container is a postgresql for msfdb.
Shared is a directory mounted at ~/shared on both containers (see docker-compose.yml).
The kali service has a persistent named volume, mounted at ~/workdir.
The postgres service also has a persistent /var/lib/postgresql/data folder where its data is stored.

# How to run
1. Perform an ssh-keygen, move/rename the public key to copy-files/id_rsa_host.pub.
2. Move/rename private key to ~/.ssh/id_rsa_host.
3. Optionally you can download a .ovpn file (for HackTheBox for example) and place it in copy-files. kali-dockerfile will automatically copy it to /config.ovpn in kali container. When inside this container do ./connect.
4. docker-compose up

-> It's best to create a host in /etc/ssh/ssh_config, otherwise you'd need to specify the keyfile everytime you ssh into the kali container.

# Remarks
* Do not do msfdb reinit, this will override /usr/share/metasploit-framework/config/database.yml which contains connection data to the postgresql container.
* If you look at the kali dockerfile, notice a github repo is pulled and copied into the image layer. This was a fix for systemd not being PID 1 in the container.
This isn't necessary anymore, but I'm leaving it cause it works. Use it like you would use systemctl normally.
* If you don't plan to use openvpn and don't have a .ovpn pack in /shared, comment out the corresponding COPY line in the kali dockerfile.
If you execute /connect.sh though, it will give an error (file not found).
* docker-postgresql-multiple-databases contains an entrypoint script to create multiple databases in the postgresql container (msf needs both msf and msf_test).
postgres documentation: *After the entrypoint calls `initdb` to create the default `postgres` user and database,
it will run any `*.sql` files and source any `*.sh` scripts found in that
directory to do further initialization before starting the service.* Which is where this script is mounted.
